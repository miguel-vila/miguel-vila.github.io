<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta name="author" content="Miguel Vilá" />
        <link href="../images/favicon.ico" rel="icon">
        <meta name="viewport" content="width=device-width" />
        <meta http-equiv="Cache-Control" content="max-age=86400, must-revalidate" />

        
        <meta property="og:title" content="Conway's Game Of Life in Elm" />
        <meta property="twitter:title" content="Conway's Game Of Life in Elm" />
        

        
        <meta name="description" content="Conway's Game Of Life in Elm" />
        <meta property="og:description" content="Conway's Game Of Life in Elm" />
        <meta property="twitter:description" content="Conway's Game Of Life in Elm" />
        

        <meta property="og:type" content="website" />
        <meta property="twitter:card" content="summary" />

        
        <meta property="og:image" content="https://miguel-vila.github.io/images/conway.png" />
        

        <title>
            
                Conway's Game Of Life in Elm | invariante
            
        </title>
        <link rel="stylesheet" type="text/css" href="../css/markdown.css" />
        <link rel="stylesheet" type="text/css" href="../css/syntax.css" />
        <link rel="stylesheet" type="text/css" href="../assets/style.css" />
        <link href="assets/css" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Libre+Baskerville" rel="stylesheet" type="text/css">
        <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
        </script>
        <link rel="stylesheet" href="../css/style.css">
        
        

    </head>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <body>
    <header>
        <h1>invariante</h1>
        <div class="bottom__header">
            <nav class="main__nav">
                <a href="#" class="close__menu">
                    <span></span>
                    <span></span>
                </a>
                <li><a href="../">Home</a></li>
                <li><a href="../archive.html">Blog</a></li>
                <li><a href="../resume_EN.pdf">Resume</a></li>
                <li><a href="../side-projects.html">Side Projects</a></li>
                <li><a href="../feed.xml"><img src="../images/feed-icon.png" height="14px" width="14px" alt="rss-feed"></a></li>
                <li class="spacer">|</li>
                <li><a href="https://github.com/miguel-vila/">Github</a></li>
                <li><a href="https://keybase.io/miguel">Keybase</a></li>
                <li><a href="../pgp.txt">PGP</a></li>
                <li><a href="https://www.goodreads.com/user/show/64099742-miguel-vil">Goodreads</a></li>
            </nav>
            <div class="bottom__right">
                <div class="menu__mobile">
                    <a href="#">
                    <span></span>
                    <span></span>
                    <span></span>
                    </a>
                </div>
                <div class="dark__mode">
                    <a href="#"><img src="../images/moon.png" alt="moon" id="theme-toggle-icon"></a>
                </div>
            </div>
        </div>
    </header>
    <div class="main__container">
        
        <div id="content" class="inside">
    <div class="info">
        
        Jan 12 2017
        
    </div>
    <div class="info">
        
        Tags: <a title="All pages tagged 'Elm'." href="../tags/Elm.html">Elm</a>, <a title="All pages tagged 'Functional Programming'." href="../tags/Functional%20Programming.html">Functional Programming</a>, <a title="All pages tagged 'Conway's Game Of Life'." href="../tags/Conway%27s%20Game%20Of%20Life.html">Conway's Game Of Life</a> 
        
    </div>
    <hr>
    <p><a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Conway’s Game Of Life</a> is a cellular automaton: just a very simple model of computation that pretends to emulate “life”. It consists of a grid of cells each one of which can be alive or dead. Taken from Wikipedia these are the rules:</p>
<blockquote>
<p>At each step in time, the following transitions occur:</p>
</blockquote>
<blockquote>
<ul>
<li>Any live cell with fewer than two live neighbours dies, as if caused by underpopulation.</li>
<li>Any live cell with two or three live neighbours lives on to the next generation.</li>
<li>Any live cell with more than three live neighbours dies, as if by overpopulation.</li>
<li>Any dead cell with exactly three live neighbours becomes a live cell, as if by reproduction.</li>
</ul>
</blockquote>
<p>You can see it live here (the column at the right side):</p>
<div data-align="center">
<blockquote class="instagram-media" data-instgrm-version="7" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:658px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);">
<div style="padding:8px;">
<div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:50.0% 0; text-align:center; width:100%;">
<div style=" background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;">

</div>
</div>
<p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">
<a href="https://www.instagram.com/p/BNFcfHTA0K3/" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">Un vídeo publicado por Miguel Vilá (<span class="citation" data-cites="miguel_vila">@miguel_vila</span>)</a> el <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2016-11-21T20:09:29+00:00">21 de Nov de 2016 a la(s) 12:09 PST</time>
</p>
</div>
</blockquote>
<script async defer src="//platform.instagram.com/en_US/embeds.js"></script>
</div>
<p>That was an art installation called <em>With a Rhythmic Instinction to be Able to Travel Beyond Existing Forces of Life</em> by <a href="https://en.wikipedia.org/wiki/Philippe_Parreno">Phillippe Parreno</a>. You can even see it slows down from time to time when too much “collisions” happen.</p>
<p>So I built the Game Of Life using <a href="http://elm-lang.org/">Elm</a> (code is <a href="https://github.com/miguel-vila/conway">here</a>). Elm is a functional language that targets front-end applications. It’s similar to Haskell but it doesn’t have type classes. It has a very dogmatic perspective on how to build applications (the so called <a href="https://guide.elm-lang.org/architecture/">Elm architecture</a>) which relies in function composition to produce components composition. You can play around with my implementation here:</p>
<script type="text/javascript" src="../code/elm-conway.js"></script>
<div id="elm-conway">

</div>
<script type="text/javascript">
Elm.Conway.embed(document.getElementById("elm-conway"));
</script>
<p>It gets old very quickly.</p>
<p>So, while building it I learned a bunch of things:</p>
<h2 id="the-core-logic">The core logic</h2>
<p>As it turns out the core logic (the step rules) are very easy to implement.</p>
<p>Starting with some type definitions:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> alias <span class="dt">Cell</span> <span class="ot">=</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    { active <span class="op">:</span> <span class="dt">Bool</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    , x <span class="op">:</span> <span class="dt">Int</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    , y <span class="op">:</span> <span class="dt">Int</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> alias <span class="dt">Grid</span> <span class="ot">=</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Array</span> (<span class="dt">Array</span> <span class="dt">Cell</span>)</span></code></pre></div>
<p>Then the core logic is here:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>updateCell <span class="op">:</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Cell</span> <span class="ot">-&gt;</span> <span class="dt">Cell</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>updateCell grid cell <span class="ot">=</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        neighbours <span class="ot">=</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            getNeighbours cell grid</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        liveNeighbours <span class="ot">=</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            List.length <span class="op">&lt;|</span> List.filter <span class="op">.</span>active neighbours</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        newState <span class="ot">=</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> cell<span class="op">.</span>active <span class="kw">then</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                liveNeighbours <span class="op">==</span> <span class="dv">2</span> <span class="op">||</span> liveNeighbours <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                liveNeighbours <span class="op">==</span> <span class="dv">3</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">in</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        { cell <span class="op">|</span> active <span class="ot">=</span> newState }</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>step <span class="op">:</span> <span class="dt">Grid</span> <span class="ot">-&gt;</span> <span class="dt">Grid</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>step grid <span class="ot">=</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    Array.map (Array.map (updateCell grid)) grid</span></code></pre></div>
<p>You can see the other functions <a href="https://github.com/miguel-vila/conway/blob/7225158399d5ae41d39e6cac2464c1062743d8eb/src/Model.elm#L31-L60">here</a>. Those are also kind of simple.</p>
<p>With this it’s very easy to create the <code>update</code> and <code>view</code> functions of the Elm architecture.</p>
<h2 id="rendering">Rendering</h2>
<p>I decided to use plain HTML elements because tracking which cell was clicked in a canvas is harder. In Elm every graphical element is rendered according to a function you describe, there are no templates or anything like that. The good thing about this is that you can continue to leverage the language when describing the views.</p>
<p>Starting with your domain types like <code>Cell</code> you build an Html from it with a function, say <code>cellView: Cell -&gt; Html Msg</code>. Then for a composed type like <code>Grid</code> you create a function <code>gridView : Grid -&gt; Html Msg</code> by using the <code>cellView</code> function we built before. Thus, graphical component composition is achieved by composing functions which is something very simple! I think that idea is powerful, useful and simple.</p>
<h2 id="random-grid-generation">Random grid generation</h2>
<p>One interesting challenge was how to generate a random configuration of the grid with some of the cells alive and others dead. Elm’s <a href="http://package.elm-lang.org/packages/elm-lang/core/4.0.5/Random">Random</a> library has a very nice approach, which is usual in functional languages. For a boolean value they could have provided a function that, when called, would return a random boolean. The problem is that this function wouldn’t be purely functional because different invocations would result in different values being returned. A better way is to return something that can generate a random value. And then, when we want to generate a random value we use this generator to create a <code>Cmd Msg</code> value which we are going to give to Elm’s runtime. It will execute the random generation (that’s executing a side effect, possibly changing the state of a random seed) and will deliver us (through the <code>update</code> function) the result.</p>
<p>Talking in code this is what we do:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- length of the square grid</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">25</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Msg</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="op">...</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">GenerateRandomGrid</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">|</span> <span class="dt">SetRandomGrid</span> <span class="dt">Grid</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>update <span class="op">:</span> <span class="dt">Msg</span> <span class="ot">-&gt;</span> <span class="dt">Model</span> <span class="ot">-&gt;</span> ( <span class="dt">Model</span>, <span class="dt">Cmd</span> <span class="dt">Msg</span> )</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>update msg model <span class="ot">=</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> msg <span class="kw">of</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">GenerateRandomGrid</span> <span class="ot">-&gt;</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            model <span class="op">!</span> [ generateRandomGrid ]</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">SetRandomGrid</span> randGrid <span class="ot">-&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>            { model <span class="op">|</span> grid <span class="ot">=</span> randGrid } <span class="op">!</span> []</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>generateRandomGrid <span class="op">:</span> <span class="dt">Cmd</span> <span class="dt">Msg</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>generateRandomGrid <span class="ot">=</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    Random.generate <span class="dt">SetRandomGrid</span> (randomGrid n)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>randomGrid <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> <span class="dt">Grid</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>randomGrid n <span class="ot">=</span> <span class="op">???</span></span></code></pre></div>
<p><a href="http://package.elm-lang.org/packages/elm-lang/core/4.0.5/Random#generate"><code>Random.generate</code></a> is the function that “performs” the side effect. It creates a <code>Cmd Msg</code> that Elm’s runtime receives, produces a random value according to the generator and hands it back trough the <code>update</code> function.</p>
<p>The strategy of delaying some computation and returning a representation of it is very common in functional programming. This allows us to have very declarative combinator functions.</p>
<p>The question then is: how to build a <code>Generator Grid</code>? To do this we can start with something that generates a random boolean and from that we can build a <code>Generator Cell</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>randomCell <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> <span class="dt">Cell</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>randomCell x y <span class="ot">=</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    Random.map (\active <span class="ot">-&gt;</span> <span class="dt">Cell</span> active x y) Random.bool</span></code></pre></div>
<p><code>Random.map</code> is one of those useful combinator functions I was talking about. It receives two things: a function and a generator and returns a new generator that applies the input function to the generated values.</p>
<p>Now let’s say we want to generate a row of <code>n</code> cells with some index <code>x</code>. We could try something like this:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>randomRow <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> (<span class="dt">Array</span> <span class="dt">Cell</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>randomRow n x <span class="ot">=</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    randomCell x</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Array.repeat n</span></code></pre></div>
<p>But we are returning a <code>Array (Int -&gt; Generator Cell)</code>! We can apply the index for each element like this:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>randomRow <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> (<span class="dt">Array</span> <span class="dt">Cell</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>randomRow n x <span class="ot">=</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    randomCell x</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Array.repeat n</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Array.indexedMap (\y getCellGen <span class="ot">-&gt;</span> getCellGen y)</span></code></pre></div>
<p>A smart-ass way to do the same:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>randomRow <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> (<span class="dt">Array</span> <span class="dt">Cell</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>randomRow n x <span class="ot">=</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    randomCell x</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Array.repeat n</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Array.indexedMap (<span class="op">|&gt;</span>)</span></code></pre></div>
<p>But we are still not returning a <code>Generator (Array Cell)</code>, we are returning a <code>Array (Generator Cell)</code>! Does this sound like a familiar problem? It turns out that this is a very common combinator in functional programming. In other languages this type flipping function (we want to exchange the types <code>Generator</code> and <code>Array</code>) is called <code>sequence</code>. Unfortunately the standard library doesn’t have it, but <a href="http://package.elm-lang.org/packages/elm-community/random-extra/latest"><code>Random.Extra</code></a> does. It’s called <code>together</code> there and it works on <code>List</code>, not <code>Array</code>.</p>
<div class="note">
<p class="aside-header">
<strong>Aside</strong> <span class="clickable">(Click!)</span>
</p>
<div class="note-content">
<p>In Haskell the function that turns a <code>[m a]</code> into a <code>m [a]</code> (similar to what we want to do here) is called <a href="https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:sequence"><code>sequence</code></a>. I think it’s more common to use <a href="https://hackage.haskell.org/package/base-4.9.0.0/docs/Prelude.html#v:mapM"><code>mapM</code></a>, though. In Haskell there are type classes so this function can be generalized for every type in the <em>Applicative</em> type class (Haskell restricts to <em>Monad</em> but this is a historical error). In Elm this function must be implemented explicitly for each type that has the same interface as an <em>Applicative</em>.</p>
</div>
</div>
<p>Thus, we can get what we want like this:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>randomRow <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> (<span class="dt">Array</span> <span class="dt">Cell</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>randomRow n x <span class="ot">=</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    randomCell x</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> List.repeat n</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> List.indexedMap (<span class="op">|&gt;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Random.Extra.together</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Random.map Array.fromList</span></code></pre></div>
<p>Now we want to use this function to generate a random grid of cells, given a number <code>n</code> (the number of rows and columns). Curiously the code is very similar:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>randomGrid <span class="op">:</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Generator</span> <span class="dt">Grid</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>randomGrid n <span class="ot">=</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    (randomRow n)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> List.repeat n</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> List.indexedMap (<span class="op">|&gt;</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Random.Extra.together</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> Random.map Array.fromList</span></code></pre></div>
<h2 id="coloring-patterns">Coloring patterns</h2>
<p>During a run some interesting <a href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life#Examples_of_patterns">patterns</a> can arise. There is even a <a href="http://www.conwaylife.com/wiki/Category:Patterns">wiki section</a> classifying a lot of them. So I decided to give some specific color when some of these patterns arises.</p>
<p>To do this I took a very simplistic approach:</p>
<ol type="1">
<li>Identify contiguous regions of live cells.</li>
<li>For each of these regions try to match it against a set of templates of patterns.</li>
<li>Those regions that matched some pattern will be shown with a different color.</li>
</ol>
<p>To do the first step I had to find the <a href="http://www.conwaylife.com/wiki/Category:Patterns">connected components</a> of live cells in the grid. I implemented Breadth First Search (BFS) from a specific cell like <a href="https://github.com/miguel-vila/conway/blob/7225158399d5ae41d39e6cac2464c1062743d8eb/src/Region.elm#L16-L45">this</a> and to identify the contiguous regions of live cells I run it repeatedly like <a href="https://github.com/miguel-vila/conway/blob/7225158399d5ae41d39e6cac2464c1062743d8eb/src/Region.elm#L82-L114">this</a>. Maybe for BFS I’m lacking a proper queue but other than that it didn’t turn out that difficult to implement that algorithm in a functional language.</p>
<p>Next I try to match these regions with respect to a set of pattern’s templates. First I defined a template as a non empty list of templates and a template is just a non empty list of coordinates. These coordinates should be ordered by increasing <code>x</code> and then by increasing <code>y</code> (this makes it easier a later comparison). These are the types:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> alias <span class="dt">Template</span> <span class="ot">=</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Cons</span> ( <span class="dt">Int</span>, <span class="dt">Int</span> )</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> alias <span class="dt">Pattern</span> <span class="ot">=</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Cons</span> <span class="dt">Template</span></span></code></pre></div>
<p><code>Cons</code> is just the type of a non empty list, taken from the <a href="http://package.elm-lang.org/packages/hrldcpr/elm-cons/1.0.3/Cons">library</a> with the same name.</p>
<p>To match a region against a pattern, we normalize the region by translating it to the origin as close as we can and we look for a template that matches. If some of the pattern’s templates is equal to the translated region then it’s a match:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>matchesPattern <span class="op">:</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> <span class="dt">Region</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>matchesPattern <span class="kw">pattern</span> region <span class="ot">=</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        minx <span class="ot">=</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>            region</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>                <span class="op">|&gt;</span> Cons.map <span class="op">.</span>x</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">|&gt;</span> Cons.minimum</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        miny <span class="ot">=</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            region</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                <span class="op">|&gt;</span> Cons.map <span class="op">.</span>y</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                <span class="op">|&gt;</span> Cons.minimum</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        normalized <span class="ot">=</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            region</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">|&gt;</span> Cons.map (\{ x, y } <span class="ot">-&gt;</span> ( x <span class="op">-</span> minx, y <span class="op">-</span> miny ))</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">in</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        Cons.any (\p <span class="ot">-&gt;</span> p <span class="op">==</span> normalized) <span class="kw">pattern</span></span></code></pre></div>
<p>This may not be the most efficient way to do this but it’s the first thing that came to my mind.</p>
<p>And finally to find out which color, if any, a region must have I wrote something like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>patterns <span class="op">:</span> <span class="dt">List</span> <span class="dt">Pattern</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>patterns <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>colorPalette <span class="op">:</span> <span class="dt">List</span> <span class="dt">Color</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>colorPalette <span class="ot">=</span> <span class="op">...</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>patternsAndColors <span class="op">:</span> <span class="dt">List</span> ( <span class="dt">Pattern</span>, <span class="dt">Color</span> )</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>patternsAndColors <span class="ot">=</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    List.Extra.zip patterns colorPalette</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>getRegionColor <span class="op">:</span> <span class="dt">Region</span> <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Color</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>getRegionColor region <span class="ot">=</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    find (\( <span class="kw">pattern</span>, _ ) <span class="ot">-&gt;</span> matchesPattern <span class="kw">pattern</span> region) patternsAndColors</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">|&gt;</span> <span class="dt">Maybe</span><span class="op">.</span><span class="fu">map</span> (\( _, color ) <span class="ot">-&gt;</span> color)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>getRegionsColors <span class="op">:</span> <span class="dt">List</span> <span class="dt">Region</span> <span class="ot">-&gt;</span> <span class="dt">List</span> ( <span class="dt">Region</span>, <span class="dt">Color</span> )</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>getRegionsColors <span class="ot">=</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    List.filterMap</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        (\region <span class="ot">-&gt;</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>            getRegionColor region</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">|&gt;</span> <span class="dt">Maybe</span><span class="op">.</span><span class="fu">map</span> (\color <span class="ot">-&gt;</span> region <span class="ot">=&gt;</span> color)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>        )</span></code></pre></div>
<h2 id="conclusion">Conclusion</h2>
<p>This was a fun exercise! I enjoyed very much programming in Elm! This exercise didn’t have too many side effects, though. Just the random grid generation so I don’t know if that model scales to “real” applications. Also this project didn’t involve that much component composition (not only composing the views but also the <code>update</code> functions and the <code>Model</code> types). Nevertheless, Elm is a very cool language and the Elm architecture is fun to follow. I’m not sure if it allows all the kind of patterns that can arise when building more complex applications. But unlike, say Angular, you can understand what’s going at each part of your application. No magic binding or anything like that. I don’t think I will use Elm at my job but I hope to learn more about it in the future.</p>
</div>

<hr>
<div class="inside">
    <div id="disqus_thread"></div>
    <script>
        var disqus_config = function () {
        this.page.url = "http://miguel-vila.github.io/posts/2017-01-12-gol-in-elm.html";
        this.page.identifier = "posts/2017-01-12-gol-in-elm.md".replace('posts/','').replace('.md',''); 
        };
        (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//miguel-vila.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

    </div>
    
    <script type="text/javascript" src="../scripts/main.js"></script>
    </body>
</html>
